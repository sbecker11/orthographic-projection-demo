    <div id="pageHeader">
        <h1>XForm Tester</h1>
        <button id="themeToggle">Toggle Theme</button>
    </div>

    <div id="currentConfigHeader" style="margin-bottom: 15px; text-align: center;">
    </div>

    <div class="container">
        <!-- Left Column: Controls -->
        <div class="column controls-left">
            <h2>Controls</h2>
            <div class="control-group">
                <label for="duration">Transition Duration (ms):</label>
                <input type="number" id="duration" value="500" min="0" step="50">
            </div>
             <div class="control-group">
                 <button id="startTransition">Start Transition</button>
                 <button id="replayTransitionBtn">Replay Transition</button>
                 <button id="resetPositions">Reset Positions</button>
            </div>
             <div class="control-group">
                <label>Rotation Directions:</label>
                <div class="direction-toggle" data-axis="x" data-direction="1">
                    <span>X-Axis:</span>
                    <button class="btn-dir active" data-value="1">+</button>
                    <button class="btn-dir" data-value="-1">-</button>
                    <button class="btn-dir" data-value="0">0</button>
                </div>
                 <div class="direction-toggle" data-axis="y" data-direction="1">
                     <span>Y-Axis:</span>
                    <button class="btn-dir active" data-value="1">+</button>
                    <button class="btn-dir" data-value="-1">-</button>
                    <button class="btn-dir" data-value="0">0</button>
                </div>
                 <div class="direction-toggle" data-axis="z" data-direction="1">
                     <span>Spin (Z):</span>
                    <button class="btn-dir active" data-value="1">+</button>
                    <button class="btn-dir" data-value="-1">-</button>
                    <button class="btn-dir" data-value="0">0</button>
                </div>
            </div>
             <div class="control-group">
                <label for="rectWidth">Rect Width (px):</label>
                <input type="number" id="rectWidth" value="100" min="10">
                <label for="rectHeight">Rect Height (px):</label>
                <input type="number" id="rectHeight" value="60" min="10">
                <button id="applySize">Apply Size</button>
             </div>
             <div class="control-group">
                 <button id="addPointBtn">Add Intermediate Point</button>
                 <button id="removePointBtn" class="danger" disabled>Remove Selected Point</button>
            </div>
        </div>

        <!-- Center Column: Viewport -->
        <div class="column viewport-center">
            <div class="viewport-container" id="viewport">
                <!-- Rectangles will be added here by JS -->
            </div>
        </div>

        <!-- Right Column: Persistence -->
        <div class="column persistence-right">
             <div class="saved-transitions">
                <h2>Saved Transitions</h2>
                 <ul id="savedList">
                    <!-- Saved transitions will be listed here -->
                    <li>No transitions saved yet.</li>
                 </ul>
                  <div class="control-group" id="selectedTransitionControls" style="display: none;">
                     <input type="text" id="renameInput" placeholder="New name">
                     <button id="renameTransition" class="secondary">Rename</button>
                     <button id="deleteTransition" class="danger">Delete</button>
                     <button id="replayTransition">Replay Selected</button>
                 </div>
            </div>
            <div class="control-group" style="margin-top: 20px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                 <button id="saveTransition">Save Current Configuration</button>
            </div>
        </div>

    </div>

    <style>
        /* --- CSS Variables --- */
        :root {
            --bg-color: #f0f0f0;
            --text-color: #333;
            --panel-bg: white;
            --panel-border: #ccc;
            --button-bg: #007bff;
            --button-hover-bg: #0056b3;
            --button-text: white;
            --input-border: #ccc;
            --input-bg: white;
            --rect-start-bg: rgba(0, 128, 0, 0.8);
            --rect-start-border: darkgreen;
            --rect-end-bg: rgba(255, 0, 0, 0.8);
            --rect-end-border: darkred;
            --point-marker-bg: rgba(0, 0, 255, 0.7);
            --point-marker-border: darkblue;
            --point-marker-selected-bg: rgba(0, 255, 255, 0.9);
            --point-marker-selected-border: teal;
            --shadow-color: rgba(0,0,0,0.1);
            --link-color: #007bff;
            --list-item-hover-bg: #f8f9fa;
            --list-item-selected-bg: #e0e0e0;
        }

        /* --- Base Styles --- */
        body {
            margin: 0; /* Remove default margin */
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            /* display: flex; */ /* Let body flow naturally */
            /* flex-direction: column; */
            /* align-items: center; */
        }
         #pageHeader {
             width: 100%;
             display: flex;
             justify-content: center; /* Center H1 */
             align-items: center;
             padding: 0 20px; /* Padding for button */
             box-sizing: border-box;
             margin-bottom: 15px;
             position: relative; /* For positioning toggle button */
        }
        #pageHeader h1 {
             margin: 0;
             text-align: center;
        }
        #themeToggle {
            position: absolute; /* Position relative to header */
            right: 20px; /* Align to right padding */
            top: 50%;
            transform: translateY(-50%);
            padding: 5px 10px;
            font-size: 0.9em;
            cursor: pointer;
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--input-border);
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        /* --- Layout Overrides for 3 Columns --- */
        .container {
            max-width: 1600px; /* Allow container to be wider */
            align-items: flex-start; /* Align columns to the top */
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            background-color: var(--panel-bg);
        }
        .column {
            /* Base styles for all columns */
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: fit-content; /* Prevent columns stretching vertically */
        }
        .controls-left, .persistence-right {
            flex: 1; /* Allow left and right columns to share remaining space */
            min-width: 280px; /* Minimum width for controls */
            max-width: 350px; /* Optional: Max width */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            background-color: var(--panel-bg);
        }
        .viewport-center {
            flex-shrink: 0; /* Prevent viewport from shrinking */
        }
        .viewport-container {
            /* flex-grow: 1; */ /* No longer needed */
            position: relative;
            background-color: var(--panel-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
            overflow: hidden;
            width: 500px;
            height: 500px;
            border: 1px solid var(--panel-border);
            perspective: 1000px;
        }
        .rect {
            /* flex-grow: 1; */ /* No longer needed as it's in a fixed-width column */
            /* Position, size, border etc. remain from original styles */
        }
        .rect-start {
            background-color: var(--rect-start-bg);
            border: 2px solid var(--rect-start-border);
            z-index: 1; /* Start rect below */
            /* flex-grow: 1; */ /* No longer needed as it's in a fixed-width column */
            /* Position, size, border etc. remain from original styles */
        }
        .rect-end {
            background-color: var(--rect-end-bg);
            border: 2px solid var(--rect-end-border);
            z-index: 2; /* End rect above, draggable */
            /* flex-grow: 1; */ /* No longer needed as it's in a fixed-width column */
            /* Position, size, border etc. remain from original styles */
        }
        input[type="number"], input[type="text"] {
            width: calc(100% - 16px);
            padding: 8px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            margin-bottom: 10px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        button {
            border-radius: 4px;
            background-color: var(--button-bg);
            color: var(--button-text);
            cursor: pointer;
        }
        button:hover {
            background-color: var(--button-hover-bg);
        }
        button.secondary {
            /* flex-grow: 1; */ /* No longer needed as it's in a fixed-width column */
            /* Position, size, border etc. remain from original styles */
        }
        .point-marker {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: var(--point-marker-bg);
            border: 1px solid var(--point-marker-border);
            border-radius: 50%;
            /* flex-grow: 1; */ /* No longer needed as it's in a fixed-width column */
            /* Position, size, border etc. remain from original styles */
        }
        .point-marker.selected {
            background-color: var(--point-marker-selected-bg);
            border: 2px solid var(--point-marker-selected-border);
        }
        .saved-transitions li:hover {
            /* background-color: #f8f9fa; */
             background-color: var(--list-item-hover-bg);
        }
        .saved-transitions li.selected {
            /* background-color: #e0e0e0; */
             background-color: var(--list-item-selected-bg);
            font-weight: bold;
        }
        /* Specific style for active zero button */
        .direction-toggle button[data-value="0"].active {
             /* background-color: #ffc107; */ /* Yellow for zero */
             /* color: #333; */
             /* border-color: #e0a800; */
             background-color: orange; /* Using name for easier dark mode */
             color: black;
             border-color: darkorange;
             opacity: 1.0;
        }

        /* --- Dark Mode Overrides --- */
        body.dark-mode {
            --bg-color: #2d2d2d;
            --text-color: #e0e0e0;
            --panel-bg: #3c3c3c;
            --panel-border: #555;
            --button-bg: #0056b3;
            --button-hover-bg: #007bff;
            --button-text: #e0e0e0;
            --input-border: #555;
            --input-bg: #4a4a4a;
            --rect-start-bg: rgba(0, 150, 0, 0.7);
            --rect-start-border: lightgreen;
            --rect-end-bg: rgba(200, 0, 0, 0.7);
            --rect-end-border: #ff4d4d;
            --point-marker-bg: rgba(100, 100, 255, 0.7);
            --point-marker-border: lightblue;
            --point-marker-selected-bg: rgba(0, 200, 200, 0.9);
            --point-marker-selected-border: cyan;
            --shadow-color: rgba(0,0,0,0.4);
            --link-color: #64b5f6;
            --list-item-hover-bg: #4f4f4f;
            --list-item-selected-bg: #616161;
        }
         body.dark-mode #themeToggle {
             background-color: var(--panel-bg);
             color: var(--text-color);
             border: 1px solid var(--input-border);
         }
         body.dark-mode .direction-toggle button[data-value="0"].active {
              background-color: darkorange; /* Adjust zero button for dark mode */
              color: #111;
              border-color: orange;
         }

    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Loaded. Initializing Transform Tester...');
        });
    </script> 